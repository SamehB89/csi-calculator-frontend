<!DOCTYPE html>
<html lang="en" dir="ltr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVM Calculator - Earned Value Management | CSI Calculator</title>
    <meta name="description" content="Calculate all Earned Value Management metrics: CPI, SPI, EAC, ETC, VAC, TCPI with interactive charts">
    <meta name="keywords" content="EVM, Earned Value Management, CPI, SPI, Project Management">
    
    <!-- Open Graph -->
    <meta property="og:title" content="EVM Calculator - Earned Value Management">
    <meta property="og:description" content="Calculate all EVM metrics automatically with interactive charts">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://csi-calc.vercel.app/evm-calculator.html">
    
    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5429423113977975" crossorigin="anonymous"></script>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/lang-toggle.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Scripts -->
    <script src="js/i18n.js"></script>
    <script src="js/theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <style>
        .evm-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .evm-hero {
            background: linear-gradient(135deg, var(--primary-color), #764ba2);
            color: white;
            padding: 3rem 2rem;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .evm-hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .evm-hero p {
            font-size: 1.2rem;
            opacity: 0.95;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .input-card, .output-card {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .input-card h2, .output-card h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .input-group small {
            display: block;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .calculate-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff !important;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .result-item {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-color);
        }
        
        .result-item h3 {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .result-interpretation {
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .status-good {
            background: rgba(76, 175, 80, 0.2);
            color: #2E7D32;
            border-left: 3px solid #4CAF50;
        }
        
        .status-warning {
            background: rgba(255, 152, 0, 0.2);
            color: #E65100;
            border-left: 3px solid #FF9800;
        }
        
        .status-danger {
            background: rgba(244, 67, 54, 0.2);
            color: #C62828;
            border-left: 3px solid #F44336;
        }
        
        .chart-container {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .chart-container h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }
        
        .help-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 16px;
            margin-top: 2rem;
        }
        
        .help-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo-container">
                <img src="assets/logo.png" alt="Logo" class="logo-image">
                <span class="logo-text">CSI Calculator</span>
            </a>
            <div class="nav-links">
                <a href="index.html" data-i18n="home" data-icon="ğŸ ">
                    <span>Home</span>
                </a>
                <a href="crew-calculator.html" data-i18n="crewCalculator" data-icon="ğŸ§®">
                    <span>Crew Calculator</span>
                </a>
                <a href="ai-planner.html" data-i18n="aiPlanner" data-icon="ğŸ¤–">
                    <span>AI Planner</span>
                </a>
                <a href="evm-calculator.html" class="active" data-i18n="evmCalculator" data-icon="ğŸ“Š">
                    <span>EVM Calculator</span>
                </a>
                <a href="blog/index.html" data-i18n="blog" data-icon="ğŸ“š">
                    <span>Knowledge Bites</span>
                </a>
                <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    ğŸŒ™
                </button>
                <button id="langToggle" class="lang-toggle" onclick="toggleLanguage()">
                    <span id="langIcon">AR</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="evm-container">
        <!-- Hero Section -->
        <div class="evm-hero">
            <h1 id="heroTitle">ğŸ“Š Earned Value Management Calculator</h1>
            <p id="heroSubtitle">Calculate all project performance metrics automatically</p>
        </div>

        <!-- Calculator Grid -->
        <div class="calculator-grid">
            <!-- Input Card -->
            <div class="input-card">
                <h2 id="inputsTitle">ğŸ”¢ Inputs</h2>
                
                <div class="input-group">
                    <label for="pv" id="pvLabel">PV - Planned Value</label>
                    <small id="pvHint">Value of work planned to be completed by today</small>
                    <input type="number" id="pv" placeholder="e.g., 500000" step="0.01">
                </div>
                
                <div class="input-group">
                    <label for="ev" id="evLabel">EV - Earned Value</label>
                    <small id="evHint">Value of work actually completed</small>
                    <input type="number" id="ev" placeholder="e.g., 450000" step="0.01">
                </div>
                
                <div class="input-group">
                    <label for="ac" id="acLabel">AC - Actual Cost</label>
                    <small id="acHint">Actual cost of work completed</small>
                    <input type="number" id="ac" placeholder="e.g., 480000" step="0.01">
                </div>
                
                <div class="input-group">
                    <label for="bac" id="bacLabel">BAC - Budget at Completion</label>
                    <small id="bacHint">Total project budget</small>
                    <input type="number" id="bac" placeholder="e.g., 1000000" step="0.01">
                </div>
                
                <div class="input-group">
                    <label for="duration" id="durationLabel">Total Project Duration</label>
                    <input type="number" id="duration" placeholder="e.g., 12" step="1">
                </div>
                
                <div class="input-group">
                    <label for="elapsed" id="elapsedLabel">Elapsed Duration</label>
                    <input type="number" id="elapsed" placeholder="e.g., 6" step="1">
                </div>
                
                <div class="input-group">
                    <label for="unit" id="unitLabel">Time Unit</label>
                    <select id="unit">
                        <option value="days" id="optDays">Days</option>
                        <option value="weeks" id="optWeeks">Weeks</option>
                        <option value="months" selected id="optMonths">Months</option>
                    </select>
                </div>
                
                <button class="calculate-btn" onclick="calculateEVM()" id="calcBtn">
                    ğŸ§® Calculate Metrics
                </button>
            </div>

            <!-- Output Card -->
            <div class="output-card">
                <h2 id="resultsTitle">ğŸ“ˆ Results</h2>
                <div id="results">
                    <p id="resultsPlaceholder" style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        Enter values in the input fields and click "Calculate Metrics"
                    </p>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div id="chartsSection" style="display: none;">
            <div class="chart-container">
                <h2 id="chartsTitle">ğŸ“Š Charts</h2>
                <canvas id="performanceChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h2 id="sCurveTitle">ğŸ“‰ S-Curve</h2>
                <canvas id="sCurveChart"></canvas>
            </div>
        </div>

        <!-- Help Section -->
        <div class="help-section">
            <h3 id="helpTitle">ğŸ“š Quick Reference Guide</h3>
            
            <h4 id="metricsHeading">Calculated Metrics:</h4>
            <ul id="metricsList">
                <li><strong>CV (Cost Variance):</strong> Cost deviation = EV - AC</li>
                <li><strong>SV (Schedule Variance):</strong> Schedule deviation = EV - PV</li>
                <li><strong>CPI (Cost Performance Index):</strong> Cost efficiency = EV / AC</li>
                <li><strong>SPI (Schedule Performance Index):</strong> Schedule efficiency = EV / PV</li>
                <li><strong>EAC (Estimate at Completion):</strong> Forecasted total cost = BAC / CPI</li>
                <li><strong>ETC (Estimate to Complete):</strong> Cost to finish = EAC - AC</li>
                <li><strong>VAC (Variance at Completion):</strong> Budget deviation = BAC - EAC</li>
                <li><strong>TCPI (To-Complete Performance Index):</strong> Required efficiency = (BAC - EV) / (BAC - AC)</li>
            </ul>
            
            <h4 id="readingHeading">Reading Results:</h4>
            <ul id="readingList">
                <li><strong style="color: #4CAF50;">âœ… Good:</strong> CPI > 1.0 or SPI > 1.0 (Good performance)</li>
                <li><strong style="color: #FF9800;">âš ï¸ Warning:</strong> 0.9 < CPI/SPI < 1.0 (Acceptable)</li>
                <li><strong style="color: #F44336;">âŒ Critical:</strong> CPI < 0.9 or SPI < 0.9 (Poor performance)</li>
            </ul>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <p class="footer-text">
                CSI Crew Calculator â€¢ Built with <span class="footer-heart">â¤ï¸</span> by <span class="footer-author">Sameh Badawy Sayed</span>
            </p>
        </div>
    </footer>

    <script src="js/evm-i18n.js"></script>
    <script>
        // EVM Calculator Logic
        let performanceChart = null;
        let sCurveChart = null;

        // Apply language on load
        window.addEventListener('load', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const btn = document.getElementById('themeToggle');
            if (btn) btn.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            
            // Apply saved language
            const savedLang = localStorage.getItem('csi_lang') || 'en';
            window.currentLang = savedLang;
            applyEvmLanguage();
        });

        function applyEvmLanguage() {
            const lang = window.currentLang || 'en';
            const isArabic = lang === 'ar';
            
            // Update HTML direction and lang
            document.documentElement.lang = lang;
            document.documentElement.dir = isArabic ? 'rtl' : 'ltr';
            
            // Update lang toggle button
            const langIcon = document.getElementById('langIcon');
            if (langIcon) langIcon.textContent = isArabic ? 'EN' : 'AR';
            
            // Translations
            const t = {
                en: {
                    heroTitle: 'ğŸ“Š Earned Value Management Calculator',
                    heroSubtitle: 'Calculate all project performance metrics automatically',
                    inputsTitle: 'ğŸ”¢ Inputs',
                    resultsTitle: 'ğŸ“ˆ Results',
                    pvLabel: 'PV - Planned Value',
                    pvHint: 'Value of work planned to be completed by today',
                    evLabel: 'EV - Earned Value',
                    evHint: 'Value of work actually completed',
                    acLabel: 'AC - Actual Cost',
                    acHint: 'Actual cost of work completed',
                    bacLabel: 'BAC - Budget at Completion',
                    bacHint: 'Total project budget',
                    durationLabel: 'Total Project Duration',
                    elapsedLabel: 'Elapsed Duration',
                    unitLabel: 'Time Unit',
                    optDays: 'Days',
                    optWeeks: 'Weeks',
                    optMonths: 'Months',
                    calcBtn: 'ğŸ§® Calculate Metrics',
                    resultsPlaceholder: 'Enter values in the input fields and click "Calculate Metrics"',
                    chartsTitle: 'ğŸ“Š Charts',
                    sCurveTitle: 'ğŸ“‰ S-Curve',
                    helpTitle: 'ğŸ“š Quick Reference Guide',
                    metricsHeading: 'Calculated Metrics:',
                    readingHeading: 'Reading Results:'
                },
                ar: {
                    heroTitle: 'ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© (EVM)',
                    heroSubtitle: 'Ø§Ø­Ø³Ø¨ Ø¬Ù…ÙŠØ¹ Ù…Ø¤Ø´Ø±Ø§Øª Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹',
                    inputsTitle: 'ğŸ”¢ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª',
                    resultsTitle: 'ğŸ“ˆ Ø§Ù„Ù†ØªØ§Ø¦Ø¬',
                    pvLabel: 'PV - Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø© (Planned Value)',
                    pvHint: 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø®Ø·Ø· Ø¥Ù†Ø¬Ø§Ø²Ù‡ Ø­ØªÙ‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…',
                    evLabel: 'EV - Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© (Earned Value)',
                    evHint: 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù†Ø¬Ø² ÙØ¹Ù„ÙŠØ§Ù‹',
                    acLabel: 'AC - Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© (Actual Cost)',
                    acHint: 'Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù†Ø¬Ø²',
                    bacLabel: 'BAC - Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠØ© (Budget at Completion)',
                    bacHint: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
                    durationLabel: 'Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠØ©',
                    elapsedLabel: 'Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠØ©',
                    unitLabel: 'Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©',
                    optDays: 'Ø£ÙŠØ§Ù…',
                    optWeeks: 'Ø£Ø³Ø§Ø¨ÙŠØ¹',
                    optMonths: 'Ø£Ø´Ù‡Ø±',
                    calcBtn: 'ğŸ§® Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª',
                    resultsPlaceholder: 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª"',
                    chartsTitle: 'ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©',
                    sCurveTitle: 'ğŸ“‰ Ù…Ù†Ø­Ù†Ù‰ S',
                    helpTitle: 'ğŸ“š Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹',
                    metricsHeading: 'Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©:',
                    readingHeading: 'Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬:'
                }
            };
            
            const texts = t[lang];
            
            // Apply translations
            Object.keys(texts).forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = texts[id];
            });
            
            // Update placeholders
            document.getElementById('pv').placeholder = lang === 'ar' ? 'Ù…Ø«Ø§Ù„: 500000' : 'e.g., 500000';
            document.getElementById('ev').placeholder = lang === 'ar' ? 'Ù…Ø«Ø§Ù„: 450000' : 'e.g., 450000';
            document.getElementById('ac').placeholder = lang === 'ar' ? 'Ù…Ø«Ø§Ù„: 480000' : 'e.g., 480000';
            document.getElementById('bac').placeholder = lang === 'ar' ? 'Ù…Ø«Ø§Ù„: 1000000' : 'e.g., 1000000';
            document.getElementById('duration').placeholder = lang === 'ar' ? 'Ù…Ø«Ø§Ù„: 12' : 'e.g., 12';
            document.getElementById('elapsed').placeholder = lang === 'ar' ? 'Ù…Ø«Ø§Ù„: 6' : 'e.g., 6';
            
            // Update help section based on language
            if (lang === 'ar') {
                document.getElementById('metricsList').innerHTML = `
                    <li><strong>CV (Cost Variance):</strong> Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„ØªÙƒÙ„ÙØ© = EV - AC</li>
                    <li><strong>SV (Schedule Variance):</strong> Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ = EV - PV</li>
                    <li><strong>CPI (Cost Performance Index):</strong> Ù…Ø¤Ø´Ø± Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙƒÙ„ÙØ© = EV / AC</li>
                    <li><strong>SPI (Schedule Performance Index):</strong> Ù…Ø¤Ø´Ø± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ = EV / PV</li>
                    <li><strong>EAC (Estimate at Completion):</strong> Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² = BAC / CPI</li>
                    <li><strong>ETC (Estimate to Complete):</strong> Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ù„Ù„Ø¥ÙƒÙ…Ø§Ù„ = EAC - AC</li>
                    <li><strong>VAC (Variance at Completion):</strong> Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² = BAC - EAC</li>
                    <li><strong>TCPI (To-Complete Performance Index):</strong> Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ = (BAC - EV) / (BAC - AC)</li>
                `;
                document.getElementById('readingList').innerHTML = `
                    <li><strong style="color: #4CAF50;">âœ… Ø¬ÙŠØ¯:</strong> CPI > 1.0 Ø£Ùˆ SPI > 1.0 (Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯)</li>
                    <li><strong style="color: #FF9800;">âš ï¸ ØªØ­Ø°ÙŠØ±:</strong> 0.9 < CPI/SPI < 1.0 (Ø£Ø¯Ø§Ø¡ Ù…Ù‚Ø¨ÙˆÙ„)</li>
                    <li><strong style="color: #F44336;">âŒ Ø®Ø·Ø±:</strong> CPI < 0.9 Ø£Ùˆ SPI < 0.9 (Ø£Ø¯Ø§Ø¡ Ø¶Ø¹ÙŠÙ)</li>
                `;
            } else {
                document.getElementById('metricsList').innerHTML = `
                    <li><strong>CV (Cost Variance):</strong> Cost deviation = EV - AC</li>
                    <li><strong>SV (Schedule Variance):</strong> Schedule deviation = EV - PV</li>
                    <li><strong>CPI (Cost Performance Index):</strong> Cost efficiency = EV / AC</li>
                    <li><strong>SPI (Schedule Performance Index):</strong> Schedule efficiency = EV / PV</li>
                    <li><strong>EAC (Estimate at Completion):</strong> Forecasted total cost = BAC / CPI</li>
                    <li><strong>ETC (Estimate to Complete):</strong> Cost to finish = EAC - AC</li>
                    <li><strong>VAC (Variance at Completion):</strong> Budget deviation = BAC - EAC</li>
                    <li><strong>TCPI (To-Complete Performance Index):</strong> Required efficiency = (BAC - EV) / (BAC - AC)</li>
                `;
                document.getElementById('readingList').innerHTML = `
                    <li><strong style="color: #4CAF50;">âœ… Good:</strong> CPI > 1.0 or SPI > 1.0 (Good performance)</li>
                    <li><strong style="color: #FF9800;">âš ï¸ Warning:</strong> 0.9 < CPI/SPI < 1.0 (Acceptable)</li>
                    <li><strong style="color: #F44336;">âŒ Critical:</strong> CPI < 0.9 or SPI < 0.9 (Poor performance)</li>
                `;
            }
        }

        // Override toggleLanguage for this page
        function toggleLanguage() {
            window.currentLang = window.currentLang === 'ar' ? 'en' : 'ar';
            localStorage.setItem('csi_lang', window.currentLang);
            applyEvmLanguage();
            applyLanguage(); // Also apply main i18n
        }

        function calculateEVM() {
            const lang = window.currentLang || 'en';
            const pv = parseFloat(document.getElementById('pv').value);
            const ev = parseFloat(document.getElementById('ev').value);
            const ac = parseFloat(document.getElementById('ac').value);
            const bac = parseFloat(document.getElementById('bac').value);
            const duration = parseFloat(document.getElementById('duration').value);
            const elapsed = parseFloat(document.getElementById('elapsed').value);
            
            // Validation
            if (isNaN(pv) || isNaN(ev) || isNaN(ac)) {
                alert(lang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (PV, EV, AC)' : 'Please enter basic values (PV, EV, AC)');
                return;
            }
            
            if (pv <= 0 || ev < 0 || ac <= 0) {
                alert(lang === 'ar' ? 'Ø§Ù„Ù‚ÙŠÙ… ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±' : 'Values must be greater than zero');
                return;
            }
            
            // Calculate metrics
            const cv = ev - ac;
            const sv = ev - pv;
            const cpi = ev / ac;
            const spi = ev / pv;
            
            let eac, etc, vac, tcpi;
            if (!isNaN(bac) && bac > 0) {
                eac = bac / cpi;
                etc = eac - ac;
                vac = bac - eac;
                const remainingWork = bac - ev;
                const remainingBudget = bac - ac;
                tcpi = remainingWork / remainingBudget;
            }
            
            let estimatedDuration;
            if (!isNaN(duration) && !isNaN(elapsed) && duration > 0 && elapsed > 0) {
                estimatedDuration = duration / spi;
            }
            
            displayResults({ cv, sv, cpi, spi, eac, etc, vac, tcpi, pv, ev, ac, bac, estimatedDuration, duration }, lang);
            
            document.getElementById('chartsSection').style.display = 'block';
            createCharts({ cpi, spi, pv, ev, ac, bac }, lang);
        }

        function displayResults(m, lang) {
            const isAr = lang === 'ar';
            const t = {
                cvTitle: isAr ? 'CV - Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„ØªÙƒÙ„ÙØ©' : 'CV - Cost Variance',
                svTitle: isAr ? 'SV - Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ' : 'SV - Schedule Variance',
                cpiTitle: isAr ? 'CPI - Ù…Ø¤Ø´Ø± Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙƒÙ„ÙØ©' : 'CPI - Cost Performance Index',
                spiTitle: isAr ? 'SPI - Ù…Ø¤Ø´Ø± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„' : 'SPI - Schedule Performance Index',
                eacTitle: isAr ? 'EAC - Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²' : 'EAC - Estimate at Completion',
                etcTitle: isAr ? 'ETC - Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ù„Ù„Ø¥ÙƒÙ…Ø§Ù„' : 'ETC - Estimate to Complete',
                vacTitle: isAr ? 'VAC - Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²' : 'VAC - Variance at Completion',
                tcpiTitle: isAr ? 'TCPI - Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨' : 'TCPI - To-Complete Performance Index',
                good: isAr ? 'âœ… Ù…Ù…ØªØ§Ø²!' : 'âœ… Excellent!',
                warning: isAr ? 'âš ï¸ ØªØ­Ø°ÙŠØ±' : 'âš ï¸ Warning',
                danger: isAr ? 'âŒ Ø®Ø·Ø±' : 'âŒ Critical',
                underBudget: isAr ? 'ØªÙˆÙÙŠØ± ÙÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©' : 'Under budget',
                overBudget: isAr ? 'ØªØ¬Ø§ÙˆØ² ÙÙŠ Ø§Ù„ØªÙƒÙ„ÙØ© - ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªØµØ­ÙŠØ­ÙŠØ©' : 'Over budget - corrective action needed',
                aheadSchedule: isAr ? 'Ù…ØªÙ‚Ø¯Ù… Ø¹Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„' : 'Ahead of schedule',
                behindSchedule: isAr ? 'Ù…ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ - ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªØµØ­ÙŠØ­ÙŠØ©' : 'Behind schedule - corrective action needed',
                goodPerf: isAr ? 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯' : 'Good performance',
                acceptable: isAr ? 'Ø£Ø¯Ø§Ø¡ Ù…Ù‚Ø¨ÙˆÙ„' : 'Acceptable performance',
                poor: isAr ? 'Ø£Ø¯Ø§Ø¡ Ø¶Ø¹ÙŠÙ - ÙŠØªØ·Ù„Ø¨ ØªØ¯Ø®Ù„ ÙÙˆØ±ÙŠ' : 'Poor performance - immediate action needed'
            };
            
            const formatNum = (n) => new Intl.NumberFormat(isAr ? 'ar-EG' : 'en-US').format(n);
            
            let html = '';
            
            // CV
            html += createResultItem(t.cvTitle, formatNum(m.cv), m.cv >= 0 ? 'status-good' : 'status-danger', 
                m.cv >= 0 ? `${t.good} ${t.underBudget}` : `${t.danger} ${t.overBudget}`);
            
            // SV
            html += createResultItem(t.svTitle, formatNum(m.sv), m.sv >= 0 ? 'status-good' : 'status-danger',
                m.sv >= 0 ? `${t.good} ${t.aheadSchedule}` : `${t.danger} ${t.behindSchedule}`);
            
            // CPI
            const cpiStatus = m.cpi >= 1 ? 'status-good' : (m.cpi >= 0.9 ? 'status-warning' : 'status-danger');
            const cpiMsg = m.cpi >= 1 ? `${t.good} ${t.goodPerf}` : (m.cpi >= 0.9 ? `${t.warning} ${t.acceptable}` : `${t.danger} ${t.poor}`);
            html += createResultItem(t.cpiTitle, m.cpi.toFixed(3), cpiStatus, cpiMsg);
            
            // SPI
            const spiStatus = m.spi >= 1 ? 'status-good' : (m.spi >= 0.9 ? 'status-warning' : 'status-danger');
            const spiMsg = m.spi >= 1 ? `${t.good} ${t.goodPerf}` : (m.spi >= 0.9 ? `${t.warning} ${t.acceptable}` : `${t.danger} ${t.poor}`);
            html += createResultItem(t.spiTitle, m.spi.toFixed(3), spiStatus, spiMsg);
            
            // EAC
            if (m.eac) {
                html += createResultItem(t.eacTitle, formatNum(m.eac.toFixed(0)), m.eac <= m.bac ? 'status-good' : 'status-danger',
                    isAr ? 'Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹' : 'Forecasted final project cost');
            }
            
            // ETC
            if (m.etc) {
                html += createResultItem(t.etcTitle, formatNum(m.etc.toFixed(0)), 'status-info',
                    isAr ? 'Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹' : 'Cost needed to complete the project');
            }
            
            // VAC
            if (m.vac !== undefined) {
                html += createResultItem(t.vacTitle, formatNum(m.vac.toFixed(0)), m.vac >= 0 ? 'status-good' : 'status-danger',
                    m.vac >= 0 ? (isAr ? 'Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…ØªÙˆÙ‚Ø¹ Ø£Ù† ÙŠÙ†ØªÙ‡ÙŠ Ø¨ØªÙˆÙÙŠØ±' : 'Project expected to finish under budget') 
                             : (isAr ? 'Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…ØªÙˆÙ‚Ø¹ Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©' : 'Project expected to exceed budget'));
            }
            
            // TCPI
            if (m.tcpi) {
                const tcpiStatus = m.tcpi <= m.cpi ? 'status-good' : (m.tcpi <= 1.1 ? 'status-warning' : 'status-danger');
                html += createResultItem(t.tcpiTitle, m.tcpi.toFixed(3), tcpiStatus,
                    m.tcpi <= m.cpi ? (isAr ? 'Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒØ§ÙÙ' : 'Current performance is sufficient') 
                                    : (isAr ? 'ÙŠØªØ·Ù„Ø¨ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡' : 'Performance improvement needed'));
            }
            
            document.getElementById('results').innerHTML = html;
        }

        function createResultItem(title, value, statusClass, interpretation) {
            return `
                <div class="result-item">
                    <h3>${title}</h3>
                    <div class="result-value">${value}</div>
                    <div class="result-interpretation ${statusClass}">${interpretation}</div>
                </div>
            `;
        }

        function createCharts(m, lang) {
            const isAr = lang === 'ar';
            
            if (performanceChart) performanceChart.destroy();
            if (sCurveChart) sCurveChart.destroy();
            
            // Performance Chart
            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(perfCtx, {
                type: 'bar',
                data: {
                    labels: ['CPI', 'SPI'],
                    datasets: [{
                        label: isAr ? 'Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡' : 'Performance Indices',
                        data: [m.cpi, m.spi],
                        backgroundColor: [
                            m.cpi >= 1 ? 'rgba(76, 175, 80, 0.8)' : 'rgba(244, 67, 54, 0.8)',
                            m.spi >= 1 ? 'rgba(76, 175, 80, 0.8)' : 'rgba(244, 67, 54, 0.8)'
                        ],
                        borderColor: [
                            m.cpi >= 1 ? 'rgb(76, 175, 80)' : 'rgb(244, 67, 54)',
                            m.spi >= 1 ? 'rgb(76, 175, 80)' : 'rgb(244, 67, 54)'
                        ],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: isAr ? 'Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† >= 1.0)' : 'Performance Indices (should be >= 1.0)',
                            font: { size: 16, family: 'Inter' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: v => v.toFixed(2) }
                        }
                    }
                }
            });
            
            // S-Curve Chart
            const sCurveCtx = document.getElementById('sCurveChart').getContext('2d');
            sCurveChart = new Chart(sCurveCtx, {
                type: 'line',
                data: {
                    labels: isAr ? ['Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', 'Ø§Ù„Ø­Ø§Ù„ÙŠ', 'Ø§Ù„Ù†Ù‡Ø§ÙŠØ©'] : ['Start', 'Current', 'End'],
                    datasets: [
                        {
                            label: isAr ? 'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø© (PV)' : 'Planned Value (PV)',
                            data: [0, m.pv, m.bac || m.pv * 2],
                            borderColor: 'rgb(102, 126, 234)',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: isAr ? 'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© (EV)' : 'Earned Value (EV)',
                            data: [0, m.ev, null],
                            borderColor: 'rgb(76, 175, 80)',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: isAr ? 'Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© (AC)' : 'Actual Cost (AC)',
                            data: [0, m.ac, null],
                            borderColor: 'rgb(244, 67, 54)',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        title: {
                            display: true,
                            text: isAr ? 'Ù…Ù†Ø­Ù†Ù‰ S - ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹' : 'S-Curve - Project Progress',
                            font: { size: 16, family: 'Inter' }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
